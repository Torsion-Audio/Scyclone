name: Scyclone

on:
  workflow_dispatch: # lets you run a build from github.com
  push:
    branches: [ develop ]

env:
  # Customize the CMake build type here (Release, Debug, RelWithDebInfo, etc.)
  BUILD_TYPE: Release

jobs:
  cmake-build:
    name: CMake Build
    runs-on: ubuntu-latest

    steps:
    # First we need to install JUCEs dependencies on Linux (Thanks to Pamplejuce & McMartin & co https://forum.juce.com/t/list-of-juce-dependencies-under-linux/15121/44)
    - name: Install JUCEs Linux dependencies
      run: sudo apt-get update && sudo apt install libasound2-dev libcurl4-openssl-dev libx11-dev libxinerama-dev libxext-dev libfreetype6-dev libwebkit2gtk-4.0-dev libglu1-mesa-dev

    # The uses keyword tells the job to retrieve the action named actions/checkout. This is an action that checks out your repository and downloads it to the runner, allowing you to run actions against your code (such as testing tools). You must use the checkout action any time your workflow will run against the repository's code or you are using an action defined in the repository.
    - uses: actions/checkout@v3
    # This will get the submodles on the runner
      with:
        submodules: true

    - name: Configure CMake
    # Configure CMake in a 'build' subdirectory. `CMAKE_BUILD_TYPE` is only required if you are using a single-configuration generator such as make.
      run: cmake -B build -DCMAKE_BUILD_TYPE=${{ env.BUILD_TYPE }}
    - name: Build
      run: cmake --build build --config ${{ env.BUILD_TYPE }}
    - name: Test
      working-directory: ${{github.workspace}}/build
      run: ctest --verbose